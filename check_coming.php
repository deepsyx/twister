<?require("config.php");$max_golemina = 2000000;	$formats = array(".gif",".png",".rar",".doc",".txt",".jpg",".bmp",".psd");		if ( $_SESSION['login'] != 1 ) { header("Location: login.php"); } 	else	{		if($_POST['Submit']) {		if ( $_FILES['file']['size'] < $max_golemina )		{			$seg_format = strrchr($_FILES['file']['name'],'.'); 			if ( in_array(strtolower($seg_format),$formats) )				{				$do = clear($_POST['do']);								$result_uy = $db->query("SELECT COUNT(`id`) as `broi` FROM `users` WHERE `username`='$do'");				$result_u = $result_uy -> fetch_assoc();					if ( $result_u['broi'] == 1 )					{						$setpath = time() + rand(0,9);						$rfile = addslashes($_FILES['file']['name']);													$newlocation = "files/".$setpath."".$rfile;											if ( @move_uploaded_file($_FILES['file']["tmp_name"], $newlocation) )							{							$nao = time() + 120;							$q = $db->query("INSERT INTO `send_files` (`izpratil`,`do`,`file`,`timea`,`realname`) VALUES ('$logged[username]','$do','$newlocation','$nao','$rfile')");							$db->query("INSERT INTO `messages` (`text`,`from`,`to`,`time`) VALUES('/sendfile','$logged[username]','$do','$nao')");							if ( $q )								{								$template->assign_vars(array("error" => "<a style=\"color: green;\">Успешно добавяне.</a>"));								}							else								{								$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Невъзможно свързване с база данни.</a>"));								}							}						else							{							$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Невъзможно изпращане на файл.</a>"));							}					}				else					{						$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Потребителя не съществува.</a>"));					}									}			else				{				$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Невалиден формат на файла.</a>"));				}		}		else			{			$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Файлът е твърде голям. Максимален размер: 2 MB.</a>"));			}		}	}	$db->close();	$template -> pparse("see_it");?>