<?require("config.php");if ( $_SESSION['login'] != 1 ) { header("Location: login.php"); } else {$do = clear($_GET['do']);$user = $db->real_escape_string($_GET['user']);$user = str_replace("%","",$user);if ( $do == 'search' && !empty($user) )	{		$search_f = $db->query("SELECT `username`,`id`,`rname` FROM `users` WHERE `username` LIKE '%$user%' OR `rname` LIKE '%$user%' LIMIT 25");	while ( $row = $search_f->fetch_object() )		{			$template->assign_block_vars("show_users",array(			"id" => $row->id,			"username" => $row->username,			"rname" => $row->rname			));		}		$template -> pparse("SF_do");	}else if ( $do == 'add' )	{		$dobavi = clear($_GET['usera']);		$checky = $db->query("SELECT COUNT(`id`) as `broi` FROM `users` WHERE `id`='$dobavi'");		$check = $checky->fetch_object();		if ( $check->broi != 0 )		{			$do_checka_rz = $db->query("SELECT COUNT(`id`) as `broi` FROM `friends` WHERE `id`='$logged[id]' AND `friend`='$dobavi'");			$do_checka_r = $do_checka_rz -> fetch_object();			if ( $do_checka_r->broi == 0 )			{				if ( $logged['id'] == $dobavi )					{					$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Не може да добавяте себе си в своя лист с приятели.</a>"));					}				else					{					$dobavqm = $db->query("INSERT INTO `friends` (`id`,`friend`) VALUES('$logged[id]','$dobavi')");						if ( $dobavqm ) 							{							$template->assign_vars(array("error" => "<a style=\"color: green;\">Абонатът е добавен успещно във вашия лист с приятели.</a>"));							}						else							{							$template->assign_vars(array("error" => "Грешка при добавяне! Администраторът е уведомен!"));							}					}								}			else			{			$template->assign_vars(array("error" => "<a style=\"color: red;\">Възникна грешка: Абонатът вече е добавен в твоя лист с приятели.</a>"));			}		}		else		{		$template->assign_vars(array("error" => 'Абонатът не съществува!')); 		}		$template -> pparse("error_page");	}else	{	$template -> pparse("SF_main");	}}$db->close();?>